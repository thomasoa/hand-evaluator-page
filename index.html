<!DOCTYPE html>
<html>
<head>
<meta name='og:image' content='/graphics/falling_small.jpg'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Interactive Hand Evaluator</title>
<script type="text/javascript"
        src="http://code.jquery.com/jquery-2.1.3.min.js">
</script>
<script type="text/javascript" src="js/bridge.js"></script>
<script type="text/javascript" src="js/evaluators.js"></script>
<script type="text/javascript" src="js/app.model.js"></script>
<script type='text/javascript'>
$(document).ready(
  function() {
     console.log('ready');
     deck = new Bridge.Deck();
     deck.holdingProc('cccc',CCCCHolding);
     deck.shapeProc('cccc',CCCCShapePoints);
     var handModel = new HandModel(deck);
     var $tbody = $("table tbody")
     var $shapeRow = $tbody.find('tr.shape');
     var $totalRow = $tbody.find('tr.total');
    var clearModel = function(e) {
          handModel.clear();
          $('input.holding').val('');
          $('#evaluationscontainer').hide();
    };

     $('input.holding').bind("propertychange change click keyup input paste",
       function(event) {
         var $input = $(this);
         var $form = $(this.form)
         suitLabel = $input.data('suit');
         hString = $input.val().toUpperCase();
         if (hString != $input.val()) {
             $input.val(hString);
         }
          
         // if the string ends with 1, treat it as ending with 10, except when
         // exiting field, for purposes of validating entry inline
         if (hString.slice(-1)=='1' && event.type !='change' && event.type!='propertychange') { 
             hString = hString+'0';
             appended = true;
         } else {
             appended = false;
         }
   
         isValid = handModel.setHolding(suitLabel,hString);
         if (!isValid) {
           $input.addClass('invalid');
         } else {
           $input.removeClass('invalid');
         } 
         if (handModel.length == 13 && !appended) {
           $form.find('input[type="submit"]').removeAttr('disabled');
         } else {
           $form.find('input[type="submit"]').attr('disabled','disabled');
         }
       }
    );
     window.onpopstate = function(event) {
         stateHash = handModel.urlHash()
         if (stateHash==null) {
             if (window.location.hash != '') {
                 initializeHash();
             }
         } else if (window.location.hash != '#' + stateHash) {
                 initializeHash();
         }
     }

     this.handModel = function() { return handModel; }
     var handleSubmit = function() {
         window.location.hash = handModel.urlHash()
         holdings = handModel.holdings();
         shape = handModel.shape();
         $shapeRow.find('.key').text(shape.short);
         total = shape.cccc();
         $shapeRow.find('.cccc').text(total.toFixed(2));
         deck.suits.forEach(
             function (suit) {
                 holding = holdings[suit.index];
                 $suitRow = $($tbody.find('tr.suit' + suit.short));
                 $suitRow.find('.holding').text(holding.display);
                 value = holding.cccc();
                 total += value;
                 $suitRow.find('.cccc').text(value.toFixed(2));
             }
         );
         $totalRow.find('.cccc').text(total.toFixed(2));
         $('#evaluationscontainer').show();
     }

     var initializeHash=function() {
         hash = window.location.hash
         clearModel();
         if (hash != '' && hash!='#' || hash!=null) {
            hStrings = hash.substring(1).split(',',4);
            map = {'S':'','H':'','D':'','C':'' }
            for (i=0; i<hStrings.length; i++) {
                suit = deck.suits.entry(i).short;
                map[suit] = hStrings[i];
            }
            $('input.holding').each(
               function(index,entry) {
                   var $entry = $(entry);
                   $entry.val(map[$entry.data('suit')]);
                   $entry.triggerHandler('change');
               }
            );
            if (handModel.length == 13) {
                handleSubmit();
            } else {
               $('#evaluationscontainer').hide();
            }

         }
     }


     initializeHash();

    $('#handentry').submit(
      function(e) {
        e.preventDefault();
        handleSubmit();
      }
    );

    $('input#clear').click(
       function (e) {
          clearModel();
          window.location.hash = '';
       }
    );
  }
);
</script>
<style>
.invalid { background: #FFCCCC; }
.invalid:focus { background: #FFDDDD; }
.red { color: red ; }
label { margin-right: 0.5em; }
#handentrycontainer { float: left; width: 15em; margin: 1em; font-size: 16pt; }
#handentrycontainer input[type=text] { height: 16pt; font-size: 14pt; }
#handentrycontainer .holding { padding-bottom: 4px; }
#evaluationscontainer {  font-size: 14pt; display: none;}
td { text-align: right; }
.notes { clear: left; }
</style>
<body>
<div>View <a href='../valuations/'>Hand Evaluation Articles</a></div>
<h1>Interactive hand evaluator</h1>
<div id='handentrycontainer'>
<form id='handentry'>
<div>Enter your hand:</div>
<div class='holding'><label for='S'>&spades;</label><input type='text' data-suit='S' id='handS' class='holding' autocomplete='off' autocapitalize='characters'/></div>
<div class='holding'><label for='H' class='red'>&hearts;</label><input type='text' data-suit='H' id='handH' class='holding' autocomplete='off' autocapitalize='characters'/></div>
<div class='holding'><label for='D' class='red'>&diams;</label><input type='text' data-suit='D' id='handD' class='holding' autocomplete='off' autocapitalize='characters'/></div>
<div class='holding'><label for='C'>&clubs;</label><input type='text' data-suit='C' id='handC' class='holding' autocomplete='off' autocapitalize='characters'/></div>
<input type='submit' id='evaluate'value='Evaluate' disabled='disabled'/>
<input type='button' name='clear' id='clear' value='Clear' tabindex='-1'/>

</form>
</div>
<div id='evaluationscontainer'>
<table id='evaluations'>
<thead>
<tr><th>&nbsp;</th><th>CCCC</th></tr>
</thead>
<tbody>
<tr class='total'>
    <td class='key'>Total</td>
    <td class='cccc'>&nbsp;</td>
</tr>
<tr class='shape'>
    <td class='key'>4-4-3-2</td>
    <td class='cccc'>&nbsp;</td>
</tr>
<tr class='suitS'>
    <td class='key'>&spades; <span class='holding'>AKQ</span></td>
    <td class='cccc'>&nbsp;</td>
</tr>
<tr class='suitH'>
    <td class='key'><span class='red'>&hearts;</span> <span class='holding'>JT9</span></td>
    <td class='cccc'>&nbsp;</td>
</tr>
<tr class='suitD'>
    <td class='key'><span class='red'>&diams;</span> <span class='holding'>876</span></td>
    <td class='cccc'>&nbsp;</td>
</tr>
<tr class='suitC'>
    <td class='key'>&clubs; <span class='holding'>5432</span></td>
    <td class='cccc'>&nbsp;</td>
</tr>
</table>
</div>
<div class='notes'>
<p><a href='#AQJ5,964,AJ64,74'>Example</a></p>
<p>This is an early release of this application.</p>
<p>To do:</p>
<ul>
<li>Implement more evaluators.
<li>Update look.
<li>Test in more browsers. (Current only tested in Chrome and Safari. It likely won't work except on 'modern' browsers.)
</ul>
<p>Features:</p>
<ul>
<li>Pure JavaScript and HTML means you can download this page and run it offline.
<li>Open source. Git repository: <a href='https://github.com/thomasoa/hand-evaluator-page'>https://github.com/thomasoa/hand-evaluator-page</a>
<li>You can log bugs on the 
<a href='https://github.com/thomasoa/hand-evaluator-page/issues/new'>GitHub issues page,</a>
or just email them to me at bridge&nbsp;AT&nbsp;thomasoandrews.com.
</ul>

</div>
</tbody>
</table>
</body>
